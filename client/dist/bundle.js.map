{"version":3,"sources":["webpack:///webpack/bootstrap eed386197fd1e192931a","webpack:///./main.js","webpack:///./lib/Renderer.js","webpack:///./lib/Abstract.js","webpack:///./lib/generators.js","webpack:///./lib/Vector2.js","webpack:///./lib/World.js","webpack:///./lib/input.js","webpack:///./communication.js","webpack:///./resources.js","webpack:///./game/JetPackGame.js","webpack:///./lib/Entity.js","webpack:///./lib/Sprite.js","webpack:///./game/Soldier.js","webpack:///./game/Bullet.js","webpack:///./game/Ground.js"],"names":["window","PLAYER_NICK","GAME_ID","canvas","document","createElement","game","renderer","world","token","frame","debug","offset","renderSoldierInfo","soldier","li","percentage","health","innerHTML","name","points","killed","classList","add","onPoints","createInfo","info","getElementById","rows","concat","soldiers","sort","a","b","map","forEach","appendChild","row","CWIDTH","CHEIGHT","init","width","height","onMsg","msg","message","onState","state","STATE_GAMEOVER","showScreen","STATE_GAMEWIN","startGame","nick","gameId","keyboard","mouse","calcOffset","cancelAnimationFrame","loop","console","log","setOffset","tick","render","requestAnimationFrame","rect","getClientRects","x","left","y","top","resize","onNick","type","screenName","screens","querySelectorAll","i","length","querySelector","remove","onSubmit","e","preventDefault","showConnErr","gameInp","value","bindEvents","addEventListener","hideConnErr","load","Renderer","ctx","getContext","body","clearRect","children","child","Abstract","id","parent","unshift","index","indexOf","undefined","splice","getNextId","getRandomName","getStringId","ids","firstNames","lastNames","Math","round","random","toString","substring","check","vec","Vector2","currentX","currentY","previousX","previousY","Object","defineProperty","set","get","scalar","v","sqrt","lengthSqre","divideScalar","pow","abs","min","max","maxLength","lengthSquared","ratio","vec1","vec2","CCW","p1","p2","p3","World","friction","gravity","offsetY","size","position","p4","entityA","entityB","collision","normal","n","rv","subVecs","velocity","directionAX","directionAY","directionBX","directionBY","towardsOnX","right","towardsOnY","bottom","velAlongNormal","dotProduct","restitution","j","mass","impulse","isFixed","sub","l","entity","acceleration","noGrav","myId","noFriction","multiplyScalar","clamp","maxSpeed","insideWorld","getCollision","kill","entities","canCollide","resolveCollision","KEYS","getKeyName","keyCode","oldX","oldY","offsetX","pageX","pageY","dx","dy","button","which","readCookie","connect","isConnected","sendMsg","c","cookie","split","item","trim","cname","cvalue","decodeURIComponent","ws","jetpack","socket","reconnecting","reconnect","cb","onDsc","setTimeout","WebSocket","onopen","onclose","close","onmessage","msgraw","JSON","parse","data","readyState","send","stringify","resources","image","json","callback","files","loadJSON","file","loaded","loadImage","xhr","XMLHttpRequest","open","onreadystatechange","response","Image","onload","src","total","SOLDIERS","KILL_POINTS","SINGLE_HIT_POINTS","BLOCK_SIZE","JetPackGame","createGround","createSoldiers","startSendingMessages","STATE_GAMEPLAY","bulletsByOwner","bullets","bullet","time","ownerId","players","player","getSoldierById","setState","createSoldier","eachBullet","lifetime","addBullet","myself","filter","getPlayerState","getBulletsState","setInterval","getMessagePayload","onKill","bind","push","setSoldierPosition","distance","Array","w","createPlatform","platformWidth","fire","setTarget","up","down","s","d","keyboardHandler","mouseHandler","handleBulltes","setGameOver","addPoints","killerId","checkForGameOver","soldiersAlive","setGameWinner","checkLifetime","addDamage","damagePoints","Entity","target","rotation","targetingEnabled","dontCollideWith","targetAngle","atan2","prototype","drawDebug","call","cx","cy","save","globalAlpha","strokeStyle","beginPath","radius","cos","sin","arc","PI","stroke","closePath","restore","move","copy","getTargetAngle","getFrameCount","frames","Sprite","resource","frameNumber","resourceName","totalFrames","relativeFrame","fillStyle","fill","lineSize","moveTo","lineTo","sprite","draw","drawChildren","MAX_HEALTH","SOLDIER_WIDTH","SOLDIER_HEIGHT","Soldier","damage","angle","scale","drawImage","drawFlameFrame","drawGun","translate","rotate","gun","flame","flameX","flameY","flameFrame","getJSONFrame","h","stateData","currentId","drawFrame","fillText","Date","now","normalize","BULLET_LIFETIME","Bullet","Ground"],"mappings":"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","file":"dist/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap eed386197fd1e192931a\n **/","import Renderer from './lib/Renderer';\nimport Vector2 from './lib/Vector2';\nimport World from './lib/World';\nimport {keyboard, mouse} from './lib/input';\nimport {connect, sendMsg, isConnected} from './communication';\nimport {resources} from './resources'\n\nwindow.PLAYER_NICK = \"foobar\";\nwindow.GAME_ID = \"gameid0123\";\n\nimport Game from './game/JetPackGame';\n\nvar canvas = document.createElement('canvas');\nvar game, renderer, world, token, frame = 0;\nvar debug = true;\nvar offset = new Vector2();\n\nfunction renderSoldierInfo(soldier) {\n  let li = document.createElement('li');\n  let percentage = soldier.health * 100;\n  li.innerHTML = `\n    <strong>${soldier.name}</strong>\n    <span class=\"health\">\n     <span class=\"health-bar\" style=\"width:${percentage}%\"></span> \n    </span>\n    <div class=\"points\">Points: ${soldier.points || 0}</div>\n  `;\n  if (soldier.killed) {\n    li.classList.add('killed')\n  }\n  return li;\n}\n\nfunction onPoints(soldier, points, game) {\n  createInfo(game);\n}\n\nfunction createInfo(game) {\n  let info = document.getElementById('info');\n  info.innerHTML = '';\n  let rows = [].concat(game.world.soldiers).sort((a, b) => {\n    if (a.points < b.points) {\n      return 1;\n    }\n    if (a.points > b.points) {\n      return -1;\n    }\n  }).map(soldier => renderSoldierInfo(soldier));\n  rows.forEach(row => info.appendChild(row));\n}\n\nconst CWIDTH = 680;\nconst CHEIGHT = 460;\n\nfunction init() {\n  canvas.width = CWIDTH;\n  canvas.height = CHEIGHT;\n  document.getElementById('canvas').appendChild(canvas);\n}\n\nfunction onMsg(msg) {\n  game && game.message(msg);\n}\n\nfunction onState(state) {\n  if (state === Game.STATE_GAMEOVER) {\n    showScreen('gameOver');\n  }\n  if (state === Game.STATE_GAMEWIN) {\n    showScreen('gameWinner');\n  }\n}\n\nfunction startGame(nick, gameId) {\n  renderer = new Renderer({canvas});\n  world = new World(CWIDTH, CHEIGHT);\n  game = new Game({world, renderer, keyboard, mouse, nick, onState, onPoints: function (soldier, points) {\n    onPoints(soldier, points, game)\n  }});\n  calcOffset();\n  cancelAnimationFrame(token);\n  loop();\n  window.game = game;\n  createInfo(game);\n  console.log(gameId)\n}\n\nfunction loop() {\n  frame++;\n  mouse.setOffset(offset);\n  game.tick(frame);\n  renderer.render(frame, debug);\n  token = requestAnimationFrame(loop);\n}\n\nfunction calcOffset() {\n  let rect = canvas.getClientRects()[0];\n  if (rect) {\n    offset.x = rect.left;\n    offset.y = rect.top;\n  }\n}\n\nfunction resize() {\n  calcOffset();\n}\n\nfunction onNick(nick, game) {\n  showScreen('gameplay');\n  sendMsg({\n    type: \"ready\",\n    nick,\n    game\n  });\n startGame(nick, game);\n}\n\nfunction showScreen(screenName) {\n  let screens = document.querySelectorAll('.screen');\n  for (let i = 0; i < screens.length; ++i) {\n    screens[i].classList.add('hidden');\n  }\n  document.querySelector('#' + screenName).classList.remove('hidden');\n}\n\nfunction onSubmit(e) {\n  e.preventDefault();\n  if (!isConnected()) {\n    showConnErr();\n    return false;\n  }\n  let nick = document.querySelector('#setup form [name=nick]');\n  let gameInp = document.querySelector('#setup form [name=game]');\n  onNick(nick.value, gameInp.value);\n  console.log('submit', nick.value, gameInp.value)\n  return false;\n}\n\nfunction bindEvents() {\n  document.querySelector('#setup form').addEventListener('submit', onSubmit);\n  document.querySelector('#setup form button').addEventListener('click', onSubmit)\n}\n\nfunction hideConnErr() {\n  document.querySelector('#connerr').classList.add('hidden');\n}\n\nfunction showConnErr() {\n  document.querySelector('#connerr').classList.remove('hidden');\n}\n\nwindow.addEventListener('load', () => {\n  bindEvents();\n  connect(() => {\n    hideConnErr();\n    resources.load(init);\n  }, onMsg);\n});\n\nwindow.addEventListener('resize', resize);\n\n\n/** WEBPACK FOOTER **\n ** ./main.js\n **/","import Abstract from './Abstract';\n\nexport default class Renderer extends Abstract {\n  constructor({canvas}) {\n    super();\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d');\n    // this.resize();\n  }\n\n  resize() {\n    let rect = document.body.getClientRects()[0];\n    this.canvas.width = rect.width;\n    this.canvas.height = rect.height;\n    return this;\n  }\n\n  render(frame, debug) {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.children.forEach(child => child.render(this.ctx, frame, debug));\n    return this;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/Renderer.js\n **/","import {getNextId} from './generators';\r\n\r\nexport default class Abstract {\r\n  constructor() {\r\n  \tthis.id = getNextId();\r\n  \tthis.children = [];\r\n  }\r\n\r\n  add(child) {\r\n    child.parent = this;\r\n    this.children.unshift(child);\r\n  }\r\n\r\n  remove(child) {\r\n    let index = this.children.indexOf(child);\r\n    child.parent = undefined;\r\n    this.children.splice(index, 1);\r\n  }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./lib/Abstract.js\n **/","let ids = 0;\r\n\r\nexport function getNextId () {\r\n  return ids++;\r\n}\r\n\r\nlet firstNames = [\r\n  'Barbara',\r\n  'Alojzy',\r\n  'Hermenegilda',\r\n  'Ambrozja',\r\n  'Grafira',\r\n  'Glazuria',\r\n  'Gleb',\r\n  'Zbylut',\r\n  'Majkiel',\r\n  'Fabrycjo'\r\n];\r\n\r\nlet lastNames = [\r\n  'Nowak',\r\n  'Kowalski',\r\n  'Miksa',\r\n  'Szymkowskyy',\r\n  'Koldwind'\r\n];\r\n\r\nexport function getRandomName() {\r\n  return firstNames[Math.round(Math.random() * (firstNames.length -1))] + ' ' +\r\n          lastNames[Math.round(Math.random() * (lastNames.length -1))]\r\n}\r\n\r\nexport function getStringId() {\r\n  return Math.random().toString(36).substring(7);\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./lib/generators.js\n **/","function check(vec) {\n  if (typeof vec !== 'object' || typeof vec.x !== 'number' || typeof vec.y !== 'number') {\n    throw 'Vector2 expected';\n  }\n}\nexport default class Vector2 {\n  constructor(x = 0, y = 0) {\n    this.currentX = 0;\n    this.currentY = 0;\n    this.previousX = 0;\n    this.previousY = 0;\n    Object.defineProperty(this, 'x', {\n      set: function(value) {\n        this.previousX = this.currentX;\n        this.currentX = value;\n      },\n      get: function() {\n        return this.currentX;\n      }\n    });\n    Object.defineProperty(this, 'y', {\n      set: function(value) {\n        this.previousY = this.currentY;\n        this.currentY = value;\n      },\n      get: function() {\n        return this.currentY;\n      }\n    });\n    this.x = x;\n    this.y = y;\n  }\n  set(x, y) {\n    if (typeof x === 'number') {\n      this.x = x;\n    }\n    if (typeof y === 'number') {\n      this.y = y;\n    }\n  }\n  copy(vec) {\n    check(vec);\n    this.x = vec.x;\n    this.y = vec.y;\n    return this;\n  }\n  add(vec) {\n    check(vec);\n    this.x += vec.x;\n    this.y += vec.y;\n    return this;\n  }\n  sub(vec) {\n    check(vec);\n    this.x -= vec.x;\n    this.y -= vec.y;\n    return this;\n  }\n  multiply(vec) {\n    check(vec);\n    this.x *= vec.x;\n    this.y *= vec.y;\n    return this;\n  }\n  multiplyScalar(scalar) {\n    this.x *= scalar;\n    this.y *= scalar;\n    return this;\n  }\n  divide(vec) {\n    check(vec);\n    this.x /= vec.x;\n    this.y /= vec.y;\n    return this;\n  }\n  divideScalar(scalar) {\n    var v = scalar !== 0 ? 1 / scalar : 0;\n    this.x *= v;\n    this.y *= v;\n    return this;\n  }\n  min(vec) {\n    check(vec);\n    if (this.x > vec.x) {\n      this.x = vec.x;\n    }\n    if (this.y > vec.y) {\n      this.y = vec.y;\n    }\n    return this;\n  }\n  max(vec) {\n    check(vec);\n    if (this.x < vec.x) {\n      this.x = vec.x;\n    }\n    if (this.y < vec.y) {\n      this.y = vec.y;\n    }\n    return this;\n  }\n  dot(vec) {\n    check(vec);\n    return this.x * vec.x + this.y * vec.y;\n  }\n  length() {\n    return Math.sqrt(this.lengthSqre());\n  }\n  lengthSqre() {\n    return this.x * this.x + this.y * this.y;\n  }\n  normalize() {\n    return this.divideScalar(this.length());\n  }\n  distanceTo(vec) {\n    check(vec);\n    return Math.sqrt(Math.pow(vec.x - this.x, 2) +\n    Math.pow(vec.y - this.y, 2));\n  }\n  mag() {\n    return Math.abs(Math.sqrt(Math.pow(this.x, 2) +\n    Math.pow(this.y, 2)));\n  }\n  clamp(min, max) {\n    if (this.x < min) {\n      this.x = min;\n    }\n    else if (this.x > max) {\n      this.x = max;\n    }\n    if (this.y < min) {\n      this.y = min;\n    }\n    else if (this.y > max) {\n      this.y = max;\n    }\n    return this;\n  }\n  limit(maxLength) {\n    var lengthSquared = this.lengthSqre();\n    if ((lengthSquared > maxLength * maxLength) && (lengthSquared > 0)) {\n      var ratio = maxLength / Math.sqrt(lengthSquared);\n      this.x *= ratio;\n      this.y *= ratio;\n    }\n    return this;\n  }\n  static subVecs(vec1, vec2) {\n    check(vec1);\n    check(vec2);\n    return new Vector2(vec1.x - vec2.x, vec1.y - vec2.y);\n  }\n  static addVecs(vec1, vec2) {\n    check(vec1);\n    check(vec2);\n    return new Vector2(vec1.x + vec2.x, vec1.y + vec2.y);\n  }\n  static multiplyVecs(vec1, vec2) {\n    check(vec1);\n    check(vec2);\n    return new Vector2(vec1.x * vec2.x, vec1.y * vec2.y);\n  }\n  static dotProduct(vec1, vec2) {\n    check(vec1);\n    check(vec2);\n    return vec2.x * vec1.x + vec2.y * vec1.y;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/Vector2.js\n **/","import Abstract from './Abstract';\r\nimport Vector2 from './Vector2';\r\n\r\nfunction CCW(p1, p2, p3) {\r\n  return (p3.y - p1.y) * (p2.x - p1.x) > (p2.y - p1.y) * (p3.x - p1.x);\r\n}\r\n\r\nexport default class World extends Abstract {\r\n  constructor(width, height) {\r\n    super();\r\n    this.friction = 0.975;\r\n    this.gravity = new Vector2(0, 0.2);\r\n    let offsetY = 500;\r\n    this.size = new Vector2(width, height + offsetY);\r\n    this.position = new Vector2(0, -offsetY);\r\n  }\r\n  \r\n  linesAreIntersecting(p1, p2, p3, p4) {\r\n    return (CCW(p1, p3, p4) != CCW(p2, p3, p4)) && (CCW(p1, p2, p3) != CCW(p1, p2, p4));\r\n  }\r\n\r\n  resolveCollision(entityA, entityB, collision) {\r\n      var normal = new Vector2;\r\n      var n = new Vector2(\r\n        (entityB.position.x + entityB.size.x / 2) - (entityA.position.x + entityA.size.x / 2),\r\n        (entityB.position.y + entityB.size.y / 2) - (entityA.position.y + entityA.size.y / 2)\r\n      );\r\n\r\n      // Calculate relative velocity\r\n      var rv = Vector2.subVecs(entityB.velocity, entityA.velocity);\r\n\r\n      let directionAX = entityA.velocity.previousX - entityA.velocity.currentX; \r\n      let directionAY = entityA.velocity.previousY - entityA.velocity.currentY; \r\n      let directionBX = entityB.velocity.previousX - entityB.velocity.currentX; \r\n      let directionBY = entityB.velocity.previousY - entityB.velocity.currentY; \r\n    \r\n      let towardsOnX = (directionAX >= 0 && directionBX <= 0 && collision.left) || (directionAX <= 0 && directionBX >= 0 && collision.right);\r\n      let towardsOnY = (directionAY >= 0 && directionBY <= 0 && collision.top) || (directionAY <= 0 && directionBY >= 0 && collision.bottom);\r\n\r\n      if (Math.abs(n.x) > Math.abs(n.y)) {\r\n        if (n.x < n.y) {\r\n          normal = new Vector2(-1, 0);\r\n        } else {\r\n          normal = new Vector2(1, 0)\r\n        }\r\n      } else {\r\n        if (n.x < n.y) {\r\n          normal = new Vector2(0, 1);\r\n        } else {\r\n          normal = new Vector2(0, -1)\r\n        }\r\n      }\r\n\r\n      // Calculate relative velocity in terms of the normal direction\r\n      var velAlongNormal = Vector2.dotProduct(rv, normal);\r\n      if(velAlongNormal > 0) {\r\n        return;\r\n      }\r\n      // Calculate restitution\r\n      var e = Math.min(entityA.restitution, entityB.restitution);\r\n      // Calculate impulse scalar\r\n      var j  = -(1 + e) * velAlongNormal;\r\n      \r\n      j /= 1 / entityA.mass + 1 / entityB.mass;\r\n\r\n      // Apply impulse\r\n      var impulse = new Vector2(j * normal.x, j * normal.y);\r\n\r\n      if (!entityA.isFixed) {\r\n        entityA.velocity.sub({\r\n          x : 1 / entityA.mass * impulse.x,\r\n          y : 1 / entityA.mass * impulse.y \r\n        });\r\n      }\r\n      \r\n      if (!entityB.isFixed) {\r\n        entityB.velocity.add({\r\n          x : 1 / entityB.mass * impulse.x, \r\n          y : 1 / entityB.mass * impulse.y \r\n        });\r\n      }\r\n  }\r\n\r\n  getCollision(entityA, entityB) {\r\n    let top = entityA.position.y + entityA.size.y >= entityB.position.y && entityA.position.y + entityA.size.y <= entityB.position.y + entityB.size.y / 2;\r\n    let bottom = entityA.position.y + entityA.size.y >= entityB.position.y + entityB.size.y / 2 && entityA.position.y <= entityB.position.y + entityB.size.y;\r\n    let left = entityA.position.x + entityA.size.x >= entityB.position.x && entityA.position.x + entityA.size.x <= entityB.position.x + entityB.size.x / 2;\r\n    let right = entityA.position.x + entityA.size.x >= entityB.position.x + entityB.size.x / 2 && entityA.position.x <= entityB.position.x + entityB.size.x;\r\n    let x = left || right;\r\n    let y = top || bottom;\r\n    return {\r\n      x, y, top, left, bottom, right\r\n    }\r\n  }\r\n  \r\n  tick(frame) {\r\n    for (let i = 0, l = this.children.length; i < l; ++i) {\r\n      let entity = this.children[i];\r\n      entity.velocity.add(entity.acceleration);\r\n\r\n      if (!entity.isFixed && !entity.noGrav && entity.id === this.myId) {\r\n        entity.velocity.add(this.gravity);\r\n      }\r\n\r\n      if (!entity.noFriction) {\r\n        entity.velocity.multiplyScalar(this.friction);\r\n      }\r\n      entity.velocity.clamp(-entity.maxSpeed, entity.maxSpeed);\r\n      entity.acceleration.multiplyScalar(0);\r\n\r\n      let insideWorld = this.getCollision(entity, this);\r\n\r\n      if (!insideWorld.x || !insideWorld.y) {\r\n        if (entity.type == 'soldier') {\r\n          entity.kill();\r\n        } else {\r\n          this.remove(entity);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (!entity.isFixed) {\r\n        var entities = entity.parent.children;\r\n        var collision;\r\n        for (var n in entities) {\r\n            if (entity.canCollide(entities[n])) {\r\n              collision = this.getCollision(entity, entities[n]);\r\n              if (collision.x && collision.y) {\r\n                this.resolveCollision(entity, entities[n], collision);\r\n              }\r\n            }\r\n        }\r\n      }\r\n      entity.position.add(entity.velocity);\r\n    }\r\n  }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./lib/World.js\n **/","const KEYS = {\r\n  8:  'backspace',\r\n  9:  'tab',\r\n  13: 'enter',\r\n  32: 'space',\r\n  37: 'left',\r\n  38: 'up',\r\n  39: 'right',\r\n  40: 'down',\r\n  87: 'w',\r\n  83: 's',\r\n  65: 'a',\r\n  68: 'd',\r\n  88: 'x',\r\n  89: 'y',\r\n  90: 'z'\r\n}\r\n\r\nfunction getKeyName(keyCode) {\r\n  return KEYS[keyCode] || null;\r\n}\r\n\r\nlet oldX = 0, oldY = 0;\r\nlet offsetX = 0, offsetY = 0;\r\n\r\nwindow.addEventListener('mousemove', e => {\r\n  oldX = mouse.x;\r\n  oldY = mouse.y;\r\n  mouse.x = e.pageX - offsetX; \r\n  mouse.y = e.pageY - offsetY; \r\n  mouse.dx = oldX - mouse.x;\r\n  mouse.dy = oldY - mouse.y;\r\n});\r\n\r\nexport let mouse = {\r\n  button: [false, false, false],\r\n  x: 0,\r\n  y: 0,\r\n  dx: 0,\r\n  dy: 0,\r\n  setOffset(offset) {\r\n    offsetX = offset.x;\r\n    offsetY = offset.y;\r\n  }\r\n};\r\n\r\nexport let keyboard = {};\r\n\r\nfor (let n in KEYS) {\r\n  keyboard[KEYS[n]] = false;\r\n}\r\n\r\nwindow.addEventListener('keydown', e => {\r\n  let keyCode = e.which || e.keyCode;\r\n  keyboard[getKeyName(keyCode)] = true;\r\n});\r\n\r\nwindow.addEventListener('keyup', e => {\r\n  let keyCode = e.which || e.keyCode;\r\n  keyboard[getKeyName(keyCode)] = false;\r\n});\r\n\r\nwindow.addEventListener('mousedown', e => {\r\n  mouse.button[e.button] = true;\r\n});\r\n\r\nwindow.addEventListener('mouseup', e => {\r\n  mouse.button[e.button] = false;\r\n});\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/input.js\n **/","\nexport function readCookie(name) {\n  var c = document.cookie.split(';');\n  for (let i = 0; i < c.length; ++i) {\n    let item = c[i].trim();\n    let cookie = item.split('=');\n    let cname = cookie[0];\n    let cvalue = cookie[1];\n    if (cname && cvalue) {\n      cname = decodeURIComponent(cname).trim();\n      cvalue = decodeURIComponent(cvalue).trim();\n      if (name == cname) {\n        return cvalue;\n      }\n    }\n  }  \n}\n\nlet ws = readCookie('ws');\nlet jetpack = readCookie('jetpack');\n\nlet socket;\nlet reconnecting = false;\n\n\nfunction reconnect(cb, onMsg, onDsc) {\n  reconnecting = true;\n  setTimeout(() => {\n    if (reconnecting) {      \n      connect(cb, onMsg, onDsc)\n    }\n  }, 5000);\n}\n\nexport function connect(cb, onMsg = () => {}, onDsc = () => {}) {\n  console.log('connecting....')\n  socket = new WebSocket('ws://' + (ws || 'localhost') , jetpack || 'abc');\n\n  socket.onopen = function () {\n    cb();\n    reconnecting = false;\n  }\n\n  socket.onclose = function () {\n    console.log('CLOSE');\n    socket.close()\n    reconnect(cb, onMsg, onDsc);\n  }\n  socket.onmessage = function (msgraw) {\n    onMsg(JSON.parse(msgraw.data));\n  }\n}\n\nexport function isConnected() {\n  return socket && socket.readyState === 1;\n}\nexport function sendMsg(msg) {\n  socket && socket.send(JSON.stringify(msg));\n}\n\n\n/** WEBPACK FOOTER **\n ** ./communication.js\n **/","export var resources = {\n  image: {},\n  json: {},\n  load: function (callback) {\n    files.forEach(file => {\n      loadJSON('./' + file + '.json', json => {\n        resources.json[file] = {data: json, name: file};\n        loaded++;\n        check(callback);\n      })\n      loadImage('./' + file + '.png', image => {\n        resources.image[file] = {data: image, name: file};\n        loaded++;\n        check(callback);\n      });\n    });\n  }\n};\n\n\nfunction loadJSON(file, callback) {\n  var xhr = new XMLHttpRequest();\n  xhr.open('GET', file, true);\n  xhr.send(null);\n  xhr.onreadystatechange = () => {\n    if (xhr.readyState == 4) {\n      callback(JSON.parse(xhr.response));\n    }\n  }\n}\n\nfunction loadImage(file, callback) {\n  var image = new Image();\n  image.onload = function () {\n    callback(image)\n  }\n  image.src = file;\n}\n\nlet files = ['flame', 'soldier', 'gun'];\nlet loaded = 0;\nvar total = files.length * 2;\n\nfunction check(cb) {\n  if (total <= loaded) {\n    cb();\n  }\n}\n\n\nwindow.resources = resources;\n\n\n\n/** WEBPACK FOOTER **\n ** ./resources.js\n **/","import Entity from '../lib/Entity';\r\nimport Soldier from './Soldier';\r\nimport Bullet from './Bullet';\r\nimport Ground from './Ground';\r\n\r\nimport {sendMsg, isConnected, readCookie} from '../communication'\r\n\r\nconst SOLDIERS = 4;\r\nconst KILL_POINTS = 100;\r\nconst SINGLE_HIT_POINTS = 1;\r\nconst BLOCK_SIZE = 32;\r\n\r\nexport default class JetPackGame {\r\n  constructor({renderer, world, keyboard, mouse, onPoints, onState, nick}) {\r\n    this.renderer = renderer;\r\n    this.world = world;\r\n    this.renderer.children = this.world.children;\r\n    this.keyboard = keyboard;\r\n    this.mouse = mouse;\r\n    this.nick = nick;\r\n    this.createGround();\r\n    this.createSoldiers();\r\n    this.onPoints = onPoints;\r\n    this.onState = onState;\r\n    this.startSendingMessages();\r\n    this.state = JetPackGame.STATE_GAMEPLAY;\r\n  }\r\n\r\n  message(msg) {\r\n    switch(msg.type) {\r\n      case 'state':\r\n        let bulletsByOwner = {};\r\n        msg.state.bullets.forEach(bullet => {\r\n          let x = bullet[0];\r\n          let y = bullet[1];\r\n          let time = bullet[2];\r\n          let ownerId = bullet[3];\r\n          // this.updateBullet(x, y, time, ownerId);\r\n          // if (!bulletsByOwner[ownerId]) {\r\n          //   bulletsByOwner[ownerId] = [];\r\n          // }\r\n          // bulletsByOwner[ownerId].push(bullet);\r\n        });\r\n        msg.state.players.forEach(player => {\r\n          let id = player[0];\r\n          let data = player[1];\r\n          let soldier = getSoldierById(this, id);\r\n          if (soldier) {\r\n            soldier.setState(data, this.myId);\r\n          } else {\r\n            this.createSoldier(id, data);\r\n          }\r\n        })\r\n    }\r\n  }\r\n\r\n  updateBullet(x, y, time, ownerId) {\r\n    this.eachBullet(bullet => {\r\n      if (bullet.ownerId === ownerId && bullet.lifetime == time) {\r\n        // update\r\n        bullet.position.x = x;\r\n        bullet.position.y = y;\r\n      } else {\r\n        this.addBullet(x, y, time, ownerId)\r\n        // add bullet\r\n      }\r\n    })\r\n  }\r\n\r\n  addBullet(x, y, time, ownerId) {\r\n    let bullet = new Bullet(x, y, ownerId);\r\n    bullet.lifetime = time;\r\n    this.add(bullet);\r\n  }\r\n\r\n  getPlayerState() {\r\n      return {\r\n        health: this.myself.health,\r\n        points: this.myself.points,\r\n        killed: this.myself.killed,\r\n        x: this.myself.position.x,\r\n        y: this.myself.position.y\r\n      }\r\n  }\r\n\r\n  getBulletsState() {\r\n    return this.world.children\r\n            .filter(child => {\r\n                return child.ownerId == this.myself.id\r\n            })\r\n            .map(bullet => [bullet.position.x, bullet.position.y, bullet.lifetime, bullet.id]);\r\n  }\r\n\r\n\r\n  getMessagePayload() {\r\n    return {\r\n      type: \"state\",\r\n      player: this.getPlayerState(),\r\n      bullets: this.getBulletsState()\r\n    };\r\n  }\r\n\r\n  startSendingMessages() {\r\n    setInterval(() => {\r\n      sendMsg(this.getMessagePayload())\r\n    }, 1000 / 16);\r\n  }\r\n\r\n  createSoldier(id, data) {\r\n    let onKill = this.onKill.bind(this);\r\n    let soldier = new Soldier(0, 0, {onKill});\r\n    soldier.id = id;\r\n    data && soldier.setState(data);\r\n    this.world.soldiers.push(soldier);\r\n    this.add(soldier);\r\n    this.setSoldierPosition(soldier);\r\n    return soldier;\r\n  } \r\n\r\n  setSoldierPosition(soldier) {\r\n    soldier.position.x = Math.random() * this.world.size.x;\r\n    soldier.position.y = 30;\r\n  }\r\n\r\n  createSoldiers() {\r\n    this.world.soldiers = [];\r\n    let x = 20;\r\n    let y = 100;\r\n    let distance = 100;\r\n\r\n    this.world.soldiers = new Array(SOLDIERS);\r\n    this.myId = readCookie('jetpack');\r\n    let soldier = this.createSoldier(this.myId, null);\r\n    this.myself = soldier;\r\n    this.myself.name = this.nick;\r\n    this.world.myId = this.myId;\r\n\r\n    // this.world.soldiers[0].position.x = 50;\r\n    // this.world.soldiers[1].position.x = this.world.size.x - 50;\r\n\r\n    // this.world.soldiers[2].position.x = this.world.size.x / 2 - this.world.soldiers[2].size.x / 2;\r\n    // this.world.soldiers[2].position.y = 20;\r\n\r\n    // this.world.soldiers[3].position.x = this.world.size.x / 2 - this.world.soldiers[3].size.x / 2;\r\n    // this.world.soldiers[3].position.y = this.world.size.y - 100;\r\n  }\r\n\r\n  createPlatform(x = 0, y = 0, c = 10) {\r\n    var w = BLOCK_SIZE;\r\n    while(c--) {\r\n      this.add(new Ground(x + w * c, y, w, w));\r\n    }\r\n  }\r\n\r\n  createGround() {\r\n    let c = 5;\r\n    this.createPlatform(20, 320, c);\r\n    let platformWidth = BLOCK_SIZE * c;\r\n    this.createPlatform(this.world.size.x / 2 - platformWidth / 2, 120, c);\r\n    this.createPlatform(this.world.size.x / 2 - platformWidth / 2, 400, c);\r\n    this.createPlatform(this.world.size.x - platformWidth - 20, 320, c);\r\n  }\r\n\r\n  mouseHandler(frame) {\r\n    if (this.myself.killed && this.state !== JetPackGame.STATE_GAMEPLAY) {\r\n      return;\r\n    }\r\n    if (this.mouse.button[0]) {\r\n      this.myself.fire(frame);\r\n    }\r\n    this.myself.setTarget(this.mouse);\r\n  }\r\n\r\n  keyboardHandler(frame) {\r\n    if (this.myself.killed && this.state !== JetPackGame.STATE_GAMEPLAY) {\r\n      return;\r\n    }\r\n\r\n    let v = 0.3;\r\n    if (this.keyboard.up || this.keyboard.w) {\r\n      this.myself.acceleration.y -= v * 1.5;\r\n    }\r\n    if (this.keyboard.down  || this.keyboard.s) {\r\n      this.myself.acceleration.y += v;\r\n    }\r\n    if (this.keyboard.left || this.keyboard.a) {\r\n      this.myself.acceleration.x -= v;\r\n    }\r\n    if (this.keyboard.right || this.keyboard.d) {\r\n      this.myself.acceleration.x += v;\r\n    }\r\n  }\r\n\r\n  add(child) {\r\n    this.world.add(child);\r\n  }\r\n\r\n  remove(child) {\r\n    this.world.remove(child);\r\n  }\r\n\r\n  tick(frame) {\r\n    this.keyboardHandler(frame);\r\n    this.mouseHandler(frame);\r\n    this.world.tick(frame);\r\n    this.handleBulltes(frame);\r\n\r\n    if (!isConnected()) {\r\n      this.setGameOver();\r\n    }\r\n  }\r\n\r\n  addPoints(soldier, points) {\r\n    soldier.addPoints(points);\r\n    this.onPoints(soldier, points);\r\n  }\r\n\r\n  onKill(killerId) {\r\n    if (killerId) {\r\n      let soldier = getSoldierById(this, killerId);\r\n      this.addPoints(soldier, KILL_POINTS);\r\n    } else {\r\n      this.addPoints(this.myself, 0)\r\n    }\r\n    this.checkForGameOver();\r\n  }\r\n\r\n  checkForGameOver() {\r\n    let soldiersAlive = this.world.soldiers.filter(soldier => !soldier.killed);\r\n    if (!soldiersAlive.length) {\r\n      this.setGameOver();\r\n    }\r\n    if (soldiersAlive.length === 1) {\r\n      this.setGameWinner(soldiersAlive[0]);\r\n    }\r\n  }\r\n\r\n  setGameWinner(soldier) {\r\n    console.log('WINNER:', soldier.name);\r\n    this.setState(JetPackGame.STATE_GAMEWIN)\r\n  }\r\n\r\n  setGameOver() {\r\n    console.log('GAME OVER');\r\n    this.setState(JetPackGame.STATE_GAMEOVER)\r\n  }\r\n\r\n  setState(state) {\r\n    this.state = state;\r\n    this.onState && this.onState(state);\r\n  }\r\n\r\n  eachBullet(cb) {\r\n    this.world.children.forEach(child => {\r\n      if (child instanceof Bullet) {\r\n        cb(child);\r\n      }\r\n    });\r\n  }\r\n\r\n  handleBulltes(frame) {\r\n    let soldiers = this.world.soldiers.filter(s => !s.killed);\r\n    this.eachBullet(child => {\r\n      if (child.checkLifetime(frame)) {\r\n          this.world.remove(child);\r\n        }\r\n        for (let n = 0; n < soldiers.length; ++n) {\r\n          if (child.ownerId !== soldiers[n].id) {\r\n            let collision = this.world.getCollision(child, soldiers[n]);\r\n            if (collision.x && collision.y) {\r\n              this.addPoints(getSoldierById(this, child.ownerId), SINGLE_HIT_POINTS);\r\n              soldiers[n].addDamage(child.damagePoints, child.ownerId);\r\n              this.world.remove(child);\r\n            }\r\n          }\r\n        }\r\n    });\r\n  }\r\n}\r\n\r\n\r\nJetPackGame.STATE_GAMEPLAY = 0x0;\r\nJetPackGame.STATE_GAMEOVER = 0x1;\r\nJetPackGame.STATE_GAMEWIN = 0x2;\r\n\r\nfunction getSoldierById(game, id) {\r\n  return game.world.soldiers.filter(s => s.id === id)[0];\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./game/JetPackGame.js\n **/","import Sprite from './Sprite';\nimport Vector2 from './Vector2';\n\nexport default class Entity extends Sprite {\n  constructor(x, y, width, height) {\n    super(x, y, width, height);\n    this.acceleration = new Vector2();\n    this.velocity = new Vector2();\n    this.target = new Vector2();\n    this.maxSpeed = 10;\n    this.restitution = 1.75;\n    this.mass = 1;\n    this.rotation = 0;\n    this.isFixed = false;\n    this.targetingEnabled = false;\n    this.type = 'entity';\n    this.dontCollideWith = [];\n    this.targetAngle = 0;\n  }\n\n  getTargetAngle() {\n    return  Math.atan2(this.target.y - this.position.y, this.target.x - this.position.x);\n  }\n\n  canCollide(entity) {\n    return entity.id !== this.id && this.dontCollideWith.indexOf(entity.type) == -1;\n  }\n\n  drawDebug(ctx, frame) {\n    Sprite.prototype.drawDebug.call(this, ctx, frame);\n    if (this.targetingEnabled) {\n      let cx = this.position.x + this.size.x / 2;\n      let cy = this.position.y + this.size.y / 2;\n      ctx.save();\n      ctx.globalAlpha = 0.5;\n      ctx.strokeStyle = 'red';\n      ctx.beginPath();\n      let radius = 12;\n      let x = cx + Math.cos(this.targetAngle) * radius;\n      let y = cy + Math.sin(this.targetAngle) * radius;\n      ctx.arc(\n        x,\n        y,\n        3,\n        0,\n        Math.PI * 2,\n        false\n      );\n      ctx.stroke();\n      ctx.closePath();\n      ctx.restore();\n    }\n  }\n\n  move(x = 0, y = 0) {\n    this.acceleration.set(x, y);\n  }\n\n  moveLeft() {\n    this.move(-4, 0);\n  }\n\n  moveUp() {\n    this.move(0, -4);\n  }\n\n  moveRight() {\n    this.move(4, 0);\n  }\n\n  moveDown() {\n    this.move(0, 4);\n  }\n\n  setTarget(vec) {\n    this.target.copy(vec);\n    this.targetAngle = this.getTargetAngle();\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/Entity.js\n **/","import Abstract from './Abstract';\nimport Vector2 from './Vector2';\n\nfunction getFrameCount(frames) {\n  let c = 0;\n  for (var i in frames) {\n    c++;\n  }\n  return c;\n}\n\n\n\nexport default class Sprite extends Abstract {\n  constructor(x = 0, y = 0, width = 32, height = 32) {\n    super();\n    this.children = [];\n    this.position = new Vector2(x, y);\n    this.size = new Vector2(width, height);\n  }\n\n  getJSONFrame(resource, frameNumber, resourceName) {\n    let totalFrames = getFrameCount(resource.data.frames);\n    let relativeFrame = frameNumber % totalFrames;\n    let name = resourceName + ' ' + relativeFrame + '.ase';\n    return resource.data.frames[name].frame;\n  }\n\n  drawDebug(ctx, frame) {\n    ctx.save();\n    ctx.globalAlpha = 0.5;\n    ctx.strokeStyle = 'magenta';\n    ctx.fillStyle = 'white';\n    ctx.beginPath();\n    ctx.rect(\n      this.position.x + .5, \n      this.position.y + .5, \n      this.size.x, \n      this.size.y\n    );\n    ctx.fill();\n    ctx.stroke();\n    ctx.closePath();\n    let lineSize = 9;\n    let cx = this.position.x + this.size.x / 2 + .5;\n    let cy = this.position.y + this.size.y / 2 + .5;\n    ctx.beginPath();\n    ctx.moveTo(cx - lineSize, cy);\n    ctx.lineTo(cx + lineSize, cy);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.beginPath();\n    ctx.moveTo(cx, cy - lineSize);\n    ctx.lineTo(cx, cy + lineSize);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.restore();\n  }\n\n  drawFrame(ctx, frame) {\n    \n  }\n\n  draw(ctx, frame) {}\n\n  drawChildren(ctx, frame, debug) {\n    this.children.forEach(sprite => sprite.render(ctx, frame, debug));\n  }\n\n  render(ctx, frame, debug) {\n    if (debug && ctx) {\n      this.drawDebug(ctx, frame);\n    }\n\n    if (ctx) {\n      this.draw(ctx, frame);\n      this.drawChildren(ctx, frame, debug);\n    }\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/Sprite.js\n **/","import Entity from '../lib/Entity';\nimport Vector2 from '../lib/Vector2';\nimport {getRandomName} from '../lib/generators';\nimport {resources} from '../resources';\n\nimport Bullet from './Bullet';\n\nconst MAX_HEALTH = 1;\nconst SOLDIER_WIDTH = 32;\nconst SOLDIER_HEIGHT = 32;\n\nexport default class Soldier extends Entity {\n  constructor(x, y, {name = getRandomName(), onKill} = {}) {\n    super(x, y, SOLDIER_WIDTH, SOLDIER_HEIGHT);\n    this.type = 'soldier';\n    this.dontCollideWith = ['bullet'];\n    this.targetingEnabled = true;\n    this.health = MAX_HEALTH;\n    this.name = name;\n    this.points = 0;\n    this.onKill = onKill;\n    this.killed = false;\n  }\n\n  addDamage(damage = 0.1, killerId) {\n    this.health -= damage;\n\n    if (this.health < 0) {\n      this.health = 0;\n    }\n    if (this.health <= 0) {\n      this.kill(killerId);\n    }\n  }\n\n  addPoints(points = 0) {\n    this.points += points;\n  }\n\n  kill(killerId) {\n    if (this.parent && !this.killed) {\n      this.killed = true;\n      this.onKill && this.onKill(killerId);\n      this.parent.remove(this);\n    }\n  }\n\n  drawFrame(ctx, frameNumber) {\n    ctx.save();\n    let d = 1;\n    let angle = this.targetAngle + Math.PI\n    if (angle >= 1.7 && angle < 4.5) {\n      d = -1;\n    }\n    ctx.scale(d, 1);\n    ctx.drawImage(\n      resources.image.soldier.data, \n      this.position.x * d, \n      this.position.y,\n      this.size.x * d,\n      this.size.y\n    );\n    ctx.restore();\n    this.drawFlameFrame(ctx,frameNumber)\n    this.drawGun(ctx,frameNumber)\n  }\n\n  drawGun(ctx,frameNumber) {\n    ctx.save();\n    ctx.translate(\n      this.position.x + this.size.x / 2, \n      this.position.y + this.size.y /2\n    );\n    ctx.rotate(this.targetAngle + Math.PI);\n    ctx.translate(\n      -this.position.x - this.size.x / 2, \n      -this.position.y - this.size.y / 2\n    );\n    ctx.drawImage(\n      resources.image.gun.data,\n      this.position.x, \n      this.position.y,\n      this.size.x,\n      this.size.y\n    );\n    ctx.restore();\n  }\n\n  drawFlameFrame(ctx, frameNumber) {\n    let flame = resources.json.flame;\n\n    let flameX = 18;\n    let flameY = 21;\n    let flameFrame = this.getJSONFrame(flame, frameNumber, 'flame');\n\n    ctx.drawImage(\n      resources.image.flame.data,\n      flameFrame.x,\n      flameFrame.y,\n      flameFrame.w,\n      flameFrame.h,\n      this.position.x + flameX,\n      this.position.y + flameY,\n      flameFrame.w,\n      flameFrame.h\n    );\n  }\n\n  setState(stateData, currentId) {\n    if (this.health > stateData.health) {\n    this.health = stateData.health;\n    }\n    if (this.points > stateData.points) {\n      this.points = stateData.points;\n    }\n\n    this.name = stateData.nick;\n    if (this.id !== currentId) {\n      this.position.x = stateData.x;\n      this.position.y = stateData.y;\n    }\n    if (stateData.killed && !this.killed) {\n      this.killed = stateData.killed;\n      if (stateData.killed) {\n        this.kill();\n      }\n    }\n\n  }\n\n  draw(ctx, frame) {\n    Entity.prototype.draw.call(this, ctx, frame);\n    this.drawFrame(ctx, frame);\n    ctx.save();\n    ctx.fillStyle = 'rgba(0,0,0,0.5)';\n    ctx.beginPath();\n    ctx.rect(\n      this.position.x,\n      this.position.y - 10,\n      this.size.x,\n      4\n    );\n    ctx.fill();\n    ctx.closePath();\n    ctx.fillStyle = 'green';\n\n    ctx.beginPath();\n    ctx.rect(\n      this.position.x,\n      this.position.y - 10,\n      this.size.x * this.health,\n      4\n    );\n    ctx.fill();\n    ctx.closePath();\n\n    ctx.fillStyle = '#fff';\n    ctx.fillText(this.name, this.position.x, this.position.y - 18);\n    ctx.restore();\n  }\n\n  fire(frame) {\n    if (!this.parent) {\n      return;\n    }\n    if (frame % 15 == 0) {\n      let bullet = new Bullet(\n        this.position.x + this.size.x / 2,\n        this.position.y + this.size.y / 2,\n        this.id,\n        Date.now()\n      );\n      this.parent.add(bullet);\n      let v = Vector2.subVecs(this.target, this.position);\n      bullet.velocity.copy(v.normalize().multiplyScalar(20));\n    }\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./game/Soldier.js\n **/","import Entity from '../lib/Entity';\nimport {getStringId} from '../lib/generators';\n\nconst BULLET_LIFETIME = 3000;\n\nexport default class Bullet extends Entity {\n  constructor(x, y, ownerId) {\n    super(x, y, 6, 6);\n    this.noGrav = true;\n    this.noFriction = true;\n    this.ownerId = ownerId;\n    this.lifetime = Date.now();\n    this.type = 'bullet';\n    this.damagePoints = 0.1;\n    this.dontCollideWith = [this.type, 'soldier'];\n    this.id = this.ownerId.toString() + this.lifetime.toString() + getStringId()\n  }\n\n  checkLifetime() {\n    return Date.now() - this.lifetime > BULLET_LIFETIME;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./game/Bullet.js\n **/","import Entity from '../lib/Entity';\n\nexport default class Ground extends Entity {\n  constructor(x, y, width, height) {\n    super(x, y, width, height);\n    this.isFixed = true\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./game/Ground.js\n **/"],"sourceRoot":""}